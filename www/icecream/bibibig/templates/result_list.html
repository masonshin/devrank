{% extends "base.html" %}

{% block head %}
    <script src="{{ STATIC_URL }}resources/js/social.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}resources/js/d3.v3.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}resources/js/jquery-scrollto.js"></script>

    <script type="text/javascript">
        $(document).ready(function (){
            data = JSON.parse(JSON.stringify({{result_json}}));
            data['me']='{{me}}';

            $('#query').val("{{query}}");
            $(".task").on("click", function(d){
                var task = $(this);
                var has_active = task.hasClass("active")
                $(".active").parent().children(".task-detail").animate(
                    { height: 0, opacity: 0 },
                    'slow',
                    function() {
                            $(this).remove();
                        }
                    );
                $(".active").removeClass("active");

                if (!has_active){
                    task.addClass("active");
                    task.after("<div class='row-fluid task-detail'></div>");
                    detail = task.parent().children(".task-detail");

                    data['who'] = task.attr('id');

                    $.ajax({
                        url:"/detail.json/",
                        type: "POST",
                        data: {'json':JSON.stringify(data)},
                        success: function(d){
                            detail.hide();
                            detail.html(d);
                            detail.fadeIn();
                            task.ScrollTo();
                        },
                    });
                }
            });
        });
    </script>
{% endblock %}

{% block body %}
<div class='container'>
    <div class='row-fluid'>
            <div class="offset2 span8">
                <div id="result_head" class="row">
                    <div id="logo" class="span4">
                        <a href='/'><img src='{{ STATIC_URL }}images/logo.png'></a>
                    </div>

                    <div id="search" class="span8">
                        {% if login == True %}
                        <form id="search_form" >
                            <div class="input-append">
                                <input  placeholder="Enter Keyword" name='q' type="text" id="query" class="search" autocomplete="off"> </input>
                                <button type="submit" class="search btn" id="submit">Search</button>
                            </div>
                        </form>
                        <script>
                            $("#search_form").submit(function(e){
                                e.preventDefault();
                                var $form = $( this ),
                                q = $form.find( 'input[name="q"]' ).val(),
                                url = '/home?';
                                window.location = url+'m={{me}}&q='+q;
                            });
                        </script>
                        {% else %}
                        <a class="btn btn-large btn-info" href="/login/github">
                            <i class="icon-github icon-1x"></i>Login
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div id="result-lists" class="offset2 span8 offset2">
                {% for result in results %}
                  {% include "result.html" %}
                {% endfor %}
            </div>

    </div>
</div>
{% endblock %}
