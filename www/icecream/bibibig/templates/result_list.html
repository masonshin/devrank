{% extends "base.html" %}

{% block head %}
    <script src="{{ STATIC_URL }}resources/js/social.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}resources/js/d3.v3.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}resources/js/jquery-scrollto.js"></script>

    <script type="text/javascript">
        $(document).ready(function (){
            function activePos(who, detail){
                detail.addClass("pos");
                detail.fadeIn();

                var odd = detail.attr('odd');
                var query = "{{me}}|"+who;
                var color = "#1abc9c";
                if (odd % 2 == 0){ color =  "#f1c40f"; }

                //test query.
                query = "jongyeol|jweb";

                {% if login == True %}
                var id = 'social-graph-'+who;
                $.ajax({
                    type: "GET",
                    url: "/social.json?users=" + query,
                    success: function(result, status, xhr) {
                        detail.children().find(".loader").fadeOut();
                        $("#"+id).empty();
                        $("#"+id).css("background-color", color);

                        var width = $("#"+id).width();
                        var height = 500;

                        social_rel(result, '#' + id, width, height);
                    },
                    error: function(xhr,status,error) {
                        detail.children().find(".loader").fadeOut();
                    }
                 });
                {% endif %}
            }

            $('#query').val("{{query}}");
            $(".task").on("click", function(d){
                var task = $(this);
                var who = $(this).attr('id');
                var detail = $(this).parent().find("#detail-"+who);
                var has_pos = detail.hasClass("pos")

                $(".pos").animate(
                    { height: 0, opacity: 0 },
                    'slow',
                    function() {
                        $(this).attr("style","display:none");
                        $(this).removeClass("pos");
                        task.ScrollTo();
                        }
                );

                if (!has_pos){
                    task.ScrollTo({
                        callback: function(){
                            activePos(who, detail);
                        }
                    });
                }

            });
        });
    </script>
{% endblock %}

{% block body %}
<div class='container'>
    <div class='row-fluid'>
            <div class="offset2 span8">
                <div id="result_head" class="row">
                    <div id="logo" class="span4">
                        <a href='/'><img src='{{ STATIC_URL }}images/logo.png'></a>
                    </div>

                    {% if login == True %}
                    <div id="search" class="span8">
                        <form action="/home" id="search_form">
                            <div class="input-append">
                                <div class="control-group success">
                                    <input  placeholder="Enter Keyword" name='q' type="text" id="query" class="search" autocomplete="off"> </input>
                                    <button type="submit" class="search btn" id="submit">Search</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    {% else %}
                    <div class="offset5 span3">
                        <a class="btn btn btn-info" href="/login/github">
                            <i class="icon-github icon-1x"></i> Connect with Github
                        </a>
                    </div>
                    {% endif %}

                </div>
            </div>

            <div id="result-lists" class="offset2 span8 offset2">
                {% for result in results %}
                  {% include "result.html" %}
                {% endfor %}
            </div>

    </div>
</div>
{% endblock %}
